
<div class="bg-white shadow-md rounded-lg p-6 mb-6">
  <h1 class="text-2xl font-bold text-gray-800 mb-4">Financial Dashboard</h1>
  <p class="text-gray-600 mb-6">Summary for <%= currentMonth %></p>
  
  <!-- Financial Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <!-- Income Card -->
    <div class="bg-blue-50 rounded-lg p-6 shadow">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-700">Monthly Income</h3>
        <svg class="h-8 w-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
      <p class="text-3xl font-bold text-gray-800">₹<%= monthlyIncome.toLocaleString() %></p>
      <a href="/income" class="text-blue-600 hover:text-blue-800 text-sm mt-4 inline-block">View Details →</a>
    </div>
    
    <!-- Expenses Card -->
    <div class="bg-red-50 rounded-lg p-6 shadow">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-700">Monthly Expenses</h3>
        <svg class="h-8 w-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
      </div>
      <p class="text-3xl font-bold text-gray-800">₹<%= monthlyExpenses.toLocaleString() %></p>
      <a href="/expenses" class="text-red-600 hover:text-red-800 text-sm mt-4 inline-block">View Details →</a>
    </div>
    
    <!-- Savings Card -->
    <div class="bg-green-50 rounded-lg p-6 shadow">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-700">Monthly Savings</h3>
        <svg class="h-8 w-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
      </div>
      <p class="text-3xl font-bold text-gray-800">₹<%= monthlySavings.toLocaleString() %></p>
      <p class="text-sm text-gray-600 mt-2">Savings Rate: <%= savingsRate.toFixed(1) %>%</p>
    </div>
  </div>
  
  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Income by Source Chart -->
    <div class="bg-white rounded-lg p-6 shadow border">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Income by Source</h3>
      <div class="h-64">
        <canvas id="incomeChart"></canvas>
      </div>
    </div>
    
    <!-- Expenses by Category Chart -->
    <div class="bg-white rounded-lg p-6 shadow border">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Expenses by Category</h3>
      <div class="h-64">
        <canvas id="expenseChart"></canvas>
      </div>
    </div>
  </div>
  
  <!-- Ride Sharing Summary -->
  <% if (typeof rideSharingSummary !== 'undefined' && rideSharingSummary.length > 0) { %>
  <div class="bg-white rounded-lg p-6 shadow border mb-8">
    <h3 class="text-lg font-semibold text-gray-700 mb-4">Ride Sharing Summary</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white">
        <thead class="bg-gray-100">
          <tr>
            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Platform</th>
            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Earnings</th>
            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Expenses</th>
            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Net Profit</th>
            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Trips</th>
            <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Hours</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <% rideSharingSummary.forEach(platform => { %>
            <tr>
              <td class="py-4 px-4 whitespace-nowrap"><%= platform._id %></td>
              <td class="py-4 px-4 whitespace-nowrap">₹<%= platform.totalEarnings.toLocaleString() %></td>
              <td class="py-4 px-4 whitespace-nowrap">₹<%= platform.totalExpenses.toLocaleString() %></td>
              <td class="py-4 px-4 whitespace-nowrap">₹<%= (platform.totalEarnings - platform.totalExpenses).toLocaleString() %></td>
              <td class="py-4 px-4 whitespace-nowrap"><%= platform.totalTrips %></td>
              <td class="py-4 px-4 whitespace-nowrap"><%= platform.totalHours %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <div class="mt-4">
      <a href="/ride-sharing" class="text-blue-600 hover:text-blue-800 text-sm">View Detailed Ride Sharing Reports →</a>
    </div>
  </div>
  <% } %>
  
  <!-- Recent Transactions -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Recent Income -->
    <div class="bg-white rounded-lg p-6 shadow border">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Recent Income</h3>
      <% if (recentIncomes && recentIncomes.length > 0) { %>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white">
            <thead class="bg-gray-100">
              <tr>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source</th>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <% recentIncomes.forEach(income => { %>
                <tr>
                  <td class="py-3 px-4 whitespace-nowrap"><%= income.date.toLocaleDateString() %></td>
                  <td class="py-3 px-4 whitespace-nowrap"><%= income.source %></td>
                  <td class="py-3 px-4 whitespace-nowrap">₹<%= income.amount.toLocaleString() %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <p class="text-gray-500">No recent income transactions.</p>
      <% } %>
      <div class="mt-4">
        <a href="/income" class="text-blue-600 hover:text-blue-800 text-sm">View All Income →</a>
      </div>
    </div>
    
    <!-- Recent Expenses -->
    <div class="bg-white rounded-lg p-6 shadow border">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Recent Expenses</h3>
      <% if (recentExpenses && recentExpenses.length > 0) { %>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white">
            <thead class="bg-gray-100">
              <tr>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <% recentExpenses.forEach(expense => { %>
                <tr>
                  <td class="py-3 px-4 whitespace-nowrap"><%= expense.date.toLocaleDateString() %></td>
                  <td class="py-3 px-4 whitespace-nowrap"><%= expense.category %></td>
                  <td class="py-3 px-4 whitespace-nowrap">₹<%= expense.amount.toLocaleString() %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <p class="text-gray-500">No recent expense transactions.</p>
      <% } %>
      <div class="mt-4">
        <a href="/expense" class="text-blue-600 hover:text-blue-800 text-sm">View All Expenses →</a>
      </div>
    </div>
  </div>
</div>

<script>
  // Initialize charts when the DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    // Income Chart
    const incomeCtx = document.getElementById('incomeChart').getContext('2d');
    const incomeData = <%- JSON.stringify(incomeBySource.map(item => ({ label: item._id, value: item.total }))) %>;
    
    new Chart(incomeCtx, {
      type: 'pie',
      data: {
        labels: incomeData.map(item => item.label),
        datasets: [{
          data: incomeData.map(item => item.value),
          backgroundColor: [
            '#3B82F6', // blue-500
            '#10B981', // green-500
            '#F59E0B', // amber-500
            '#EF4444', // red-500
            '#8B5CF6', // violet-500
            '#EC4899', // pink-500
            '#6366F1'  // indigo-500
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'right'
          }
        }
      }
    });
    
    // Expense Chart
    const expenseCtx = document.getElementById('expenseChart').getContext('2d');
    const expenseData = <%- JSON.stringify(expensesByCategory.map(item => ({ label: item._id, value: item.total }))) %>;
    
    new Chart(expenseCtx, {
      type: 'pie',
      data: {
        labels: expenseData.map(item => item.label),
        datasets: [{
          data: expenseData.map(item => item.value),
          backgroundColor: [
            '#EF4444', // red-500
            '#F59E0B', // amber-500
            '#10B981', // green-500
            '#3B82F6', // blue-500
            '#8B5CF6', // violet-500
            '#EC4899', // pink-500
            '#6366F1'  // indigo-500
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'right'
          }
        }
      }
    });
  });
</script>