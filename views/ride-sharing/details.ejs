<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Ride Sharing Details</h1>
    <a href="/ride-sharing" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition duration-300 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
      Back to Dashboard
    </a>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Info Card -->
    <div class="bg-white rounded-lg shadow-md p-6 lg:col-span-2">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold text-gray-800"><%= entry.platform %> Ride Summary</h2>
        <span class="text-sm bg-blue-100 text-blue-800 py-1 px-3 rounded-full font-medium">
          <%= new Date(entry.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
        </span>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Earnings Section -->
        <div>
          <h3 class="text-lg font-medium text-gray-700 mb-3 border-b pb-2">Earnings</h3>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-gray-600">Base Fare:</span>
              <span class="font-medium">₹<%= entry.earnings.baseFare.toFixed(2) %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Tips:</span>
              <span class="font-medium">₹<%= entry.earnings.tips.toFixed(2) %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Incentives:</span>
              <span class="font-medium">₹<%= entry.earnings.incentives.toFixed(2) %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Other Earnings:</span>
              <span class="font-medium">₹<%= entry.earnings.otherEarnings.toFixed(2) %></span>
            </div>
            <div class="flex justify-between pt-2 border-t">
              <span class="text-gray-800 font-medium">Total Earnings:</span>
              <span class="text-green-600 font-bold">₹<%= entry.earnings.totalAmount.toFixed(2) %></span>
            </div>
          </div>
        </div>

        <!-- Expenses Section -->
        <div>
          <h3 class="text-lg font-medium text-gray-700 mb-3 border-b pb-2">Expenses</h3>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-gray-600">Fuel:</span>
              <span class="font-medium">₹<%= entry.expenses.fuel.toFixed(2) %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Maintenance:</span>
              <span class="font-medium">₹<%= entry.expenses.maintenance.toFixed(2) %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Commission:</span>
              <span class="font-medium">₹<%= entry.expenses.commission.toFixed(2) %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Tax:</span>
              <span class="font-medium">₹<%= entry.expenses.tax.toFixed(2) %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Other Expenses:</span>
              <span class="font-medium">₹<%= entry.expenses.otherExpenses.toFixed(2) %></span>
            </div>
            <div class="flex justify-between pt-2 border-t">
              <span class="text-gray-800 font-medium">Total Expenses:</span>
              <span class="text-red-600 font-bold">₹<%= (entry.expenses.fuel + entry.expenses.maintenance + entry.expenses.commission + entry.expenses.tax + entry.expenses.otherExpenses).toFixed(2) %></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Trip Details Section -->
      <div class="mt-6">
        <h3 class="text-lg font-medium text-gray-700 mb-3 border-b pb-2">Trip Details</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="bg-gray-50 p-3 rounded-lg">
            <div class="text-sm text-gray-500">Total Trips</div>
            <div class="text-xl font-bold text-gray-800"><%= entry.tripDetails.totalTrips %></div>
          </div>
          <div class="bg-gray-50 p-3 rounded-lg">
            <div class="text-sm text-gray-500">Total Distance</div>
            <div class="text-xl font-bold text-gray-800"><%= entry.tripDetails.totalDistance %> km</div>
          </div>
          <div class="bg-gray-50 p-3 rounded-lg">
            <div class="text-sm text-gray-500">Total Hours</div>
            <div class="text-xl font-bold text-gray-800"><%= entry.tripDetails.totalHours %> hrs</div>
          </div>
          <div class="bg-gray-50 p-3 rounded-lg">
            <div class="text-sm text-gray-500">Average Rating</div>
            <div class="text-xl font-bold text-gray-800 flex items-center">
              <%= entry.tripDetails.averageRating.toFixed(1) %>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-400 ml-1" viewBox="0 0 20 20" fill="currentColor">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Notes Section -->
      <% if (entry.notes) { %>
      <div class="mt-6">
        <h3 class="text-lg font-medium text-gray-700 mb-3 border-b pb-2">Notes</h3>
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-gray-700"><%= entry.notes %></p>
        </div>
      </div>
      <% } %>
    </div>

    <!-- Summary Card -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Financial Summary</h2>
      
      <!-- Net Earnings -->
      <div class="bg-blue-50 p-4 rounded-lg mb-6">
        <div class="text-sm text-blue-600 mb-1">Net Earnings</div>
        <div class="text-3xl font-bold text-blue-800">₹<%= entry.netEarnings.toFixed(2) %></div>
        <div class="text-xs text-blue-500 mt-1">
          <%= entry.earnings.totalAmount > 0 ? ((entry.netEarnings / entry.earnings.totalAmount) * 100).toFixed(1) : 0 %>% profit margin
        </div>
      </div>

      <!-- Per Trip/Hour Metrics -->
      <div class="space-y-4">
        <div>
          <div class="flex justify-between mb-1">
            <span class="text-sm font-medium text-gray-700">Per Trip</span>
            <span class="text-sm font-medium text-gray-700">₹<%= (entry.earnings.totalAmount / entry.tripDetails.totalTrips).toFixed(2) %></span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-green-500 h-2 rounded-full" style="width: <%= Math.min((entry.earnings.totalAmount / entry.tripDetails.totalTrips) / 500 * 100, 100) %>%"></div>
          </div>
        </div>
        
        <div>
          <div class="flex justify-between mb-1">
            <span class="text-sm font-medium text-gray-700">Per Hour</span>
            <span class="text-sm font-medium text-gray-700">₹<%= entry.tripDetails.totalHours > 0 ? (entry.earnings.totalAmount / entry.tripDetails.totalHours).toFixed(2) : '0.00' %></span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-purple-500 h-2 rounded-full" style="width: <%= entry.tripDetails.totalHours > 0 ? Math.min((entry.earnings.totalAmount / entry.tripDetails.totalHours) / 300 * 100, 100) : 0 %>%"></div>
          </div>
        </div>
        
        <div>
          <div class="flex justify-between mb-1">
            <span class="text-sm font-medium text-gray-700">Per Kilometer</span>
            <span class="text-sm font-medium text-gray-700">₹<%= entry.tripDetails.totalDistance > 0 ? (entry.earnings.totalAmount / entry.tripDetails.totalDistance).toFixed(2) : '0.00' %></span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-yellow-500 h-2 rounded-full" style="width: <%= entry.tripDetails.totalDistance > 0 ? Math.min((entry.earnings.totalAmount / entry.tripDetails.totalDistance) / 50 * 100, 100) : 0 %>%"></div>
          </div>
        </div>
      </div>

      <!-- Expense Breakdown -->
      <div class="mt-6">
        <h3 class="text-lg font-medium text-gray-700 mb-3">Expense Breakdown</h3>
        <div class="h-48">
          <canvas id="expenseChart"></canvas>
        </div>
      </div>

      <!-- Actions -->
      <div class="mt-6 flex justify-between">
        <button id="deleteEntry" class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition duration-300">
          Delete Entry
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Expense chart
    const ctx = document.getElementById('expenseChart').getContext('2d');
    
    const expenses = {
      fuel: <%= entry.expenses.fuel %>,
      maintenance: <%= entry.expenses.maintenance %>,
      commission: <%= entry.expenses.commission %>,
      tax: <%= entry.expenses.tax %>,
      other: <%= entry.expenses.otherExpenses %>
    };
    
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Fuel', 'Maintenance', 'Commission', 'Tax', 'Other'],
        datasets: [{
          data: [expenses.fuel, expenses.maintenance, expenses.commission, expenses.tax, expenses.other],
          backgroundColor: [
            '#EF4444', // Red
            '#F59E0B', // Amber
            '#3B82F6', // Blue
            '#10B981', // Green
            '#8B5CF6'  // Purple
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              boxWidth: 12
            }
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const label = context.label || '';
                const value = context.parsed || 0;
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                return `${label}: ₹${value.toFixed(2)} (${percentage}%)`;
              }
            }
          }
        }
      }
    });
    
    // Delete entry functionality
    document.getElementById('deleteEntry').addEventListener('click', function() {
      if (confirm('Are you sure you want to delete this entry? This action cannot be undone.')) {
        fetch('/ride-sharing/<%= entry._id %>', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            window.location.href = '/ride-sharing?success=Entry deleted successfully';
          } else {
            alert(data.message || 'Failed to delete entry');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred while deleting the entry');
        });
      }
    });
  });
</script>